<!DOCTYPE html>
<html>
<head>
    <title>B√≠blia Sagrada - Sistema Melhorado</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <link rel="stylesheet" href="css_biblia.css">

    <div id="app">
        <div class="controls-bar">
            <div class="filtros">
                <h2>üìñ B√≠blia Sagrada</h2>
                
                <div class="selection-group">
                    <label>Vers√£o:</label>
                    <select v-model="selectedVersion" class="version-select" @change="loadBibleVersion">
                        <option value="rc">Almeida Revista e Corrigida (RC)</option>
                        <option value="ra">Almeida Revista e Atualizada (RA)</option>
                    </select>
                </div>

                <div class="selection-group">
                    <label>Livro:</label>
                    <select v-model="selectedBook" class="book-select">
                        <option value="">Selecione um Livro</option>
                        <option v-for="book in booksbible" :key="book" :value="book">{{ book.book_name }}</option>
                    </select>
                </div>
              
                <div class="selection-group" v-if="selectedBook">
                    <label>Cap√≠tulo:</label>
                    <select v-model="selectedChapter" class="chapter-select">
                        <option value="">Selecione um Cap√≠tulo</option>
                        <option v-for="chapter in getChapters(selectedBook)" :key="chapter" :value="chapter">{{ chapter }}</option>
                    </select>
                </div>
              
                <div class="selection-group" v-if="selectedChapter">
                    <label>Vers√≠culo:</label>
                    <div class="verse-controls">
                        <input 
                            type="number" 
                            v-model.number="selectedVerse" 
                            :min="1" 
                            :max="verseCount" 
                            class="verse-input"
                            placeholder="N¬∫"
                        >
                        <span class="verse-info">de {{ verseCount }}</span>
                    </div>
                </div>

                <div class="navigation-controls" v-if="selectedBook && selectedChapter && selectedVerse">
                    <button class="nav-btn" @click="previVerse" :disabled="parseInt(selectedVerse) <= 1">
                        ‚¨ÖÔ∏è Anterior
                    </button>
        
                    <button class="nav-btn" @click="nextVerse" :disabled="parseInt(selectedVerse) >= parseInt(verseCount)">
                        Pr√≥ximo ‚û°Ô∏è
                    </button>
                </div>

                <div class="fullscreen-controls">
                    <button class="fullscreen-btn" @click="toggleFullscreen" :title="isFullscreen ? 'Sair da Tela Cheia (ESC)' : 'Entrar em Tela Cheia (F11)'">
                        {{ isFullscreen ? 'üî≤ Sair Tela Cheia' : '‚õ∂ Tela Cheia' }}
                    </button>
                </div>
            </div>
        </div>

        <div class="verse-display-area" v-if="selectedBook && selectedChapter && selectedVerse">
            <div class="title-book">
                {{selectedBook.book_name}} {{selectedChapter}}:{{selectedVerse}}
            </div>

            <div class="verse-content">
                {{displayVerse()}}
            </div>

            <!-- Dica de navega√ß√£o apenas no fullscreen -->
            <div class="fullscreen-navigation-hint" v-if="isFullscreen">
                <div class="hint-text">Use ‚¨ÖÔ∏è ‚û°Ô∏è para navegar ‚Ä¢ ESC para sair</div>
            </div>
        </div>

        <div v-else class="welcome-message">
            <h3>üëã Bem-vindo ao Sistema da B√≠blia Sagrada</h3>
            <p>Selecione um livro, cap√≠tulo e vers√≠culo para come√ßar</p>
            <div class="instructions">
                <p><strong>Atalhos do teclado:</strong></p>
                <ul>
                    <li>‚¨ÖÔ∏è ‚û°Ô∏è - Navegar entre vers√≠culos</li>
                    <li>F11 - Entrar/Sair da tela cheia</li>
                    <li>ESC - Sair da tela cheia</li>
                </ul>
            </div>
        </div>

        <div v-if="debugcode" class="debug-info">
            <pre>
                selectedbook : {{selectedBook}},
                selectedChapter : {{selectedChapter}},
                selectedVerse : {{selectedVerse}},
                isFullscreen: {{isFullscreen}}
            </pre>
        </div>
    </div>

    <script src="jsondata_almeida_rc.js"></script>
    <script src="jsondata_almeida_ra.js"></script>
    <script src="books_bible.js"></script>
    <script src="vue_2.js"></script>
    
    <script>
        var app = new Vue({
            el: '#app',
            data: {
                debugcode: false,
                message: '',
                jsonData: [],
                booksbible: booksbible,
                verseCount: 0, 
                selectedBook: "",
                selectedChapter: "",
                selectedVerse: "",
                isFullscreen: false,
                selectedVersion: "rc",
                bibleVersions: {
                    rc: null,
                    ra: null
                }
            },
            methods: {
                getChapters(book) { 
                    return Array.from({ length: book.chapters }, (_, i) => i + 1);
                },
                displayVerse() {
                    let versiculoSelecionado = this.jsonData.filter(versiculo => 
                        versiculo.book == this.selectedBook.book_id && 
                        versiculo.chapter == this.selectedChapter && 
                        versiculo.verse == this.selectedVerse
                    );
                    
                    if (versiculoSelecionado.length == 0) {
                        this.selectedChapter = 1;
                        this.selectedVerse = 1;
                        versiculoSelecionado = this.jsonData.filter(versiculo => 
                            versiculo.book == this.selectedBook.book_id && 
                            versiculo.chapter == this.selectedChapter && 
                            versiculo.verse == this.selectedVerse
                        );  
                    }

                    return versiculoSelecionado[0]?.text || "Vers√≠culo n√£o encontrado";
                },
                previVerse() {
                    if(this.selectedVerse > 1) {
                        this.selectedVerse = parseInt(this.selectedVerse) - 1;
                        console.log('Verso anterior:', this.selectedVerse);
                    }
                },
                nextVerse() {
                    console.log('nextVerse chamado - selectedVerse:', this.selectedVerse, 'verseCount:', this.verseCount);
                    if(parseInt(this.selectedVerse) < parseInt(this.verseCount)) {
                        this.selectedVerse = parseInt(this.selectedVerse) + 1;
                        console.log('Pr√≥ximo verso:', this.selectedVerse);
                    } else {
                        console.log('J√° est√° no √∫ltimo vers√≠culo');
                    }
                },
                toggleFullscreen() {
                    if (!document.fullscreenElement) {
                        document.documentElement.requestFullscreen().then(() => {
                            this.isFullscreen = true;
                            console.log('Entrou em fullscreen');
                        }).catch(err => {
                            console.log('Erro ao entrar em tela cheia:', err);
                        });
                    } else {
                        document.exitFullscreen().then(() => {
                            this.isFullscreen = false;
                            console.log('Saiu do fullscreen');
                        }).catch(err => {
                            console.log('Erro ao sair da tela cheia:', err);
                        });
                    }
                },
                updateFullscreenStatus() {
                    this.isFullscreen = !!document.fullscreenElement;
                    console.log('Status fullscreen atualizado:', this.isFullscreen);
                },
                updateVerseCount() {
                    if (!this.selectedBook || !this.selectedChapter) {
                        this.verseCount = 0;
                        return;
                    }
                    
                    let versiculosCapituloLivro = this.jsonData.filter(versiculo => 
                        versiculo.book == this.selectedBook.book_id && 
                        versiculo.chapter == this.selectedChapter
                    );
                    
                    this.verseCount = versiculosCapituloLivro.length;
                    console.log('updateVerseCount chamado - Total de vers√≠culos:', this.verseCount);
                },
                loadBibleVersion() {
                    // Resetar sele√ß√µes quando trocar de vers√£o
                    this.selectedBook = "";
                    this.selectedChapter = "";
                    this.selectedVerse = "";
                    this.verseCount = 0;
                    
                    // Carregar a vers√£o selecionada
                    if (this.selectedVersion === 'rc' && this.bibleVersions.rc) {
                        this.jsonData = this.bibleVersions.rc.verses;
                        console.log('Carregada vers√£o RC (Revista e Corrigida)');
                    } else if (this.selectedVersion === 'ra' && this.bibleVersions.ra) {
                        this.jsonData = this.bibleVersions.ra.verses;
                        console.log('Carregada vers√£o RA (Revista e Atualizada)');
                    }
                }
            },
            computed: {
                getVerses() {
                    if (!this.selectedBook || !this.selectedChapter) {
                        this.verseCount = 0;
                        return [];
                    }
                    
                    let versiculosCapituloLivro = this.jsonData.filter(versiculo => 
                        versiculo.book == this.selectedBook.book_id && 
                        versiculo.chapter == this.selectedChapter
                    );
                    
                    this.verseCount = versiculosCapituloLivro.length;
                    console.log('Contagem de vers√≠culos atualizada:', this.verseCount, 'para livro:', this.selectedBook.book_name, 'cap√≠tulo:', this.selectedChapter);
                    
                    // S√≥ resetar o vers√≠culo se n√£o estiver definido ou for inv√°lido
                    if (!this.selectedVerse || this.selectedVerse > this.verseCount) {
                        this.selectedVerse = 1;
                    }
                    
                    return Array.from({ length: this.verseCount }, (_, i) => i + 1);
                }
            },
            watch: {
                selectedVerse(newVal, oldVal) {
                    console.log('selectedVerse mudou de', oldVal, 'para', newVal, 'tipo:', typeof newVal);
                },
                verseCount(newVal, oldVal) {
                    console.log('verseCount mudou de', oldVal, 'para', newVal, 'tipo:', typeof newVal);
                },
                selectedBook(newVal, oldVal) {
                    console.log('selectedBook mudou:', newVal?.book_name);
                    this.selectedChapter = "";
                    this.selectedVerse = "";
                    this.verseCount = 0;
                },
                selectedChapter(newVal, oldVal) {
                    console.log('selectedChapter mudou para:', newVal);
                    this.selectedVerse = "";
                    // For√ßar rec√°lculo dos vers√≠culos
                    this.$nextTick(() => {
                        this.updateVerseCount();
                        if (this.verseCount > 0 && !this.selectedVerse) {
                            this.selectedVerse = 1;
                        }
                    });
                }
            },
            mounted() {
                // Inicializar as vers√µes da B√≠blia
                if (typeof jsonDataRC !== 'undefined') {
                    this.bibleVersions.rc = jsonDataRC;
                }
                if (typeof jsonDataRA !== 'undefined') {
                    this.bibleVersions.ra = jsonDataRA;
                }
                
                // Carregar a vers√£o padr√£o (RC)
                this.loadBibleVersion();
                
                // Listener para mudan√ßas no estado de tela cheia
                document.addEventListener('fullscreenchange', this.updateFullscreenStatus);
                document.addEventListener('webkitfullscreenchange', this.updateFullscreenStatus);
                document.addEventListener('mozfullscreenchange', this.updateFullscreenStatus);
                document.addEventListener('MSFullscreenChange', this.updateFullscreenStatus);
            },
            beforeDestroy() {
                // Remover listeners
                document.removeEventListener('fullscreenchange', this.updateFullscreenStatus);
                document.removeEventListener('webkitfullscreenchange', this.updateFullscreenStatus);
                document.removeEventListener('mozfullscreenchange', this.updateFullscreenStatus);
                document.removeEventListener('MSFullscreenChange', this.updateFullscreenStatus);
            }
        });
    </script>

    <script>
        // Fun√ß√£o melhorada para lidar com eventos de teclado
        function lidarComEventoDeTeclado(event) {
            // Navegar com setas apenas se h√° vers√≠culo selecionado
            if (app.selectedBook && app.selectedChapter && app.selectedVerse) {
                if (event.keyCode === 39 || event.key === 'ArrowRight') { // Seta direita
                    if (app.selectedVerse < app.verseCount) {
                        app.nextVerse();
                    }
                    event.preventDefault();
                }

                if (event.keyCode === 37 || event.key === 'ArrowLeft') { // Seta esquerda
                    if (app.selectedVerse > 1) {
                        app.previVerse();
                    }
                    event.preventDefault();
                }
            }

            // F11 para toggle fullscreen
            if (event.keyCode === 122) { // F11
                app.toggleFullscreen();
                event.preventDefault();
            }

            // ESC para sair do fullscreen (funcionalidade nativa do navegador)
            if (event.keyCode === 27 && document.fullscreenElement) { // ESC
                document.exitFullscreen();
            }
        }

        // Adicionar listener de evento de teclado
        document.addEventListener('keydown', lidarComEventoDeTeclado);
    </script>
</body>
</html>
